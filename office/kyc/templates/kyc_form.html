{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KYC Record Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #f8f9fa;
            --accent-color: #28a745;
            --header-bg-color: #f0f0f0;
            --text-color: #333;
        }

        body {
            background-color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }

        .top-nav {
            background-color: white;
            padding: 10px 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .top-nav .nav-tabs .nav-link {
            border: none;
            border-bottom: 3px solid transparent;
            color: #555;
            padding: 10px 20px;
            font-weight: 500;
        }

        .top-nav .nav-tabs .nav-link.active {
            color: var(--primary-color);
            border-color: var(--primary-color);
            background-color: transparent;
        }

        .form-container {
            background: white;
            border-radius: 0;
            box-shadow: none;
            padding: 30px;
            margin-top: 0;
            margin-bottom: 0;
            min-height: calc(100vh - 60px);
            padding-left: 5%;
            padding-right: 5%;
            box-sizing: border-box;
        }

        .section-header {
            color: var(--primary-color);
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 25px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .form-label {
            font-weight: 500;
            margin-bottom: 0;
            color: #555;
            font-size: 0.85rem;
            width: 150px;
        }

        .form-control, .form-select {
            border-radius: 4px;
            padding: 7px 10px;
            border: 1px solid #ced4da;
            transition: all 0.2s ease-in-out;
            font-size: 0.85rem;
            flex-grow: 1;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .input-group .form-control {
            border-right: none;
        }
        .input-group .btn {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        .input-group .btn:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }

        .btn-submit {
            background-color: var(--accent-color);
            border: none;
            padding: 10px 25px;
            font-weight: 500;
            transition: all 0.3s;
            border-radius: 5px;
            
        }

        .btn-submit:hover {
            background-color: #218838;
            transform: translateY(-1px);
        }

        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .form-group {
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .form-check.form-group {
            justify-content: flex-start;
            gap: 5px;
        }

        .form-check-label {
            font-size: 0.85rem;
            margin-left: 0;
        }

        @media (max-width: 768px) {
            .form-container {
                padding: 20px;
            }
            .top-nav {
                flex-direction: column;
                align-items: flex-start;
                padding: 10px 15px;
            }
            .top-nav .nav-tabs {
                margin-bottom: 10px;
            }
            .form-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            .form-label {
                width: auto;
            }
        }
        
        .field-wrapper {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .is-invalid {
            border-color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container-fluid top-nav">
        <ul class="nav nav-tabs mb-0">
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">KYC Update</a>
            </li>
        </ul>
    </div>

    <div class="form-container">
        <h4 class="text-center sm-4 text-primary">KYC Record Form</h4>

        <form method="POST" action="#">
            {% csrf_token %}
            <div class="d-flex justify-content-end">
                <div class="btn-group gap-3">
                    <a href="#" class="btn btn-sm btn-outline-secondary d-flex justify-content-center align-items-center">
                        <i class="fas fa-arrow-left me-2"></i> BACK
                    </a>
                    <button type="submit" class="btn btn-submit btn-sm text-white">
                        SUBMIT
                    </button>
                </div>
            </div>
            
            <h5 class="section-header">Personal Details</h5>

            <div class="row">
                <!-- Left Column -->
                <div class="col-md-5 offset-md-1">
                    <!-- First Name -->
                    <div class="form-group">
                        <label for="{{ form.first_name.id_for_label }}" class="form-label">
                            {{ form.first_name.label }} {% if form.first_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.first_name }}
                            {% if form.first_name.errors %}
                                <div class="error-message">{{ form.first_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Last Name -->
                    <div class="form-group">
                        <label for="{{ form.last_name.id_for_label }}" class="form-label">
                            {{ form.last_name.label }} {% if form.last_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.last_name }}
                            {% if form.last_name.errors %}
                                <div class="error-message">{{ form.last_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Father Name -->
                    <div class="form-group">
                        <label for="{{ form.father_name.id_for_label }}" class="form-label">
                            {{ form.father_name.label }} {% if form.father_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.father_name }}
                            {% if form.father_name.errors %}
                                <div class="error-message">{{ form.father_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Mobile -->
                    <div class="form-group">
                        <label for="{{ form.mobile.id_for_label }}" class="form-label">
                            {{ form.mobile.label }} {% if form.mobile.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.mobile }}
                            {% if form.mobile.errors %}
                                <div class="error-message">{{ form.mobile.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Age Proof Doc -->
                    <div class="form-group">
                        <label for="{{ form.age_proof_doc.id_for_label }}" class="form-label">
                            {{ form.age_proof_doc.label }} {% if form.age_proof_doc.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.age_proof_doc }}
                            {% if form.age_proof_doc.errors %}
                                <div class="error-message">{{ form.age_proof_doc.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Structure -->
                    <div class="form-group">
                        <label for="{{ form.structure.id_for_label }}" class="form-label">
                            {{ form.structure.label }} {% if form.structure.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.structure }}
                            {% if form.structure.errors %}
                                <div class="error-message">{{ form.structure.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Local Unit -->
                    <div class="form-group">
                        <label for="{{ form.local_unit.id_for_label }}" class="form-label">
                            {{ form.local_unit.label }} {% if form.local_unit.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.local_unit }}
                            {% if form.local_unit.errors %}
                                <div class="error-message">{{ form.local_unit.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Address -->
                    <div class="form-group">
                        <label for="{{ form.address.id_for_label }}" class="form-label">
                            {{ form.address.label }} {% if form.address.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.address }}
                            {% if form.address.errors %}
                                <div class="error-message">{{ form.address.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Temporary Address -->
                    <div class="form-group">
                        <label for="{{ form.temporary_address.id_for_label }}" class="form-label">
                            {{ form.temporary_address.label }} {% if form.temporary_address.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.temporary_address }}
                            {% if form.temporary_address.errors %}
                                <div class="error-message">{{ form.temporary_address.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Phone No -->
                    <div class="form-group">
                        <label for="{{ form.phone_no.id_for_label }}" class="form-label">
                            {{ form.phone_no.label }} {% if form.phone_no.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.phone_no }}
                            {% if form.phone_no.errors %}
                                <div class="error-message">{{ form.phone_no.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Profession -->
                    <div class="form-group">
                        <label for="{{ form.profession.id_for_label }}" class="form-label">
                            {{ form.profession.label }} {% if form.profession.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.profession }}
                            {% if form.profession.errors %}
                                <div class="error-message">{{ form.profession.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Office Address -->
                    <div class="form-group">
                        <label for="{{ form.office_address.id_for_label }}" class="form-label">
                            {{ form.office_address.label }} {% if form.office_address.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.office_address }}
                            {% if form.office_address.errors %}
                                <div class="error-message">{{ form.office_address.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Income Mode -->
                    <div class="form-group">
                        <label for="{{ form.income_mode.id_for_label }}" class="form-label">
                            {{ form.income_mode.label }} {% if form.income_mode.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.income_mode }}
                            {% if form.income_mode.errors %}
                                <div class="error-message">{{ form.income_mode.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- PAN No -->
                    <div class="form-group">
                        <label for="{{ form.pan_no.id_for_label }}" class="form-label">
                            {{ form.pan_no.label }} {% if form.pan_no.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.pan_no }}
                            {% if form.pan_no.errors %}
                                <div class="error-message">{{ form.pan_no.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Bank Ac Name -->
                    <div class="form-group">
                        <label for="{{ form.bank_ac_name.id_for_label }}" class="form-label">
                            {{ form.bank_ac_name.label }} {% if form.bank_ac_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.bank_ac_name }}
                            {% if form.bank_ac_name.errors %}
                                <div class="error-message">{{ form.bank_ac_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Nep Name -->
                    <div class="form-group">
                        <label for="{{ form.nep_name.id_for_label }}" class="form-label">
                            {{ form.nep_name.label }} {% if form.nep_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.nep_name }}
                            {% if form.nep_name.errors %}
                                <div class="error-message">{{ form.nep_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Gender -->
                    <div class="form-group">
                        <label for="{{ form.gender.id_for_label }}" class="form-label">
                            {{ form.gender.label }} {% if form.gender.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.gender }}
                            {% if form.gender.errors %}
                                <div class="error-message">{{ form.gender.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Qualification -->
                    <div class="form-group">
                        <label for="{{ form.qualification.id_for_label }}" class="form-label">
                            {{ form.qualification.label }} {% if form.qualification.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.qualification }}
                            {% if form.qualification.errors %}
                                <div class="error-message">{{ form.qualification.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Politically Involved -->
                    <div class="form-group">
                        <label for="{{ form.is_politically_involved.id_for_label }}" class="form-label">
                            {{ form.is_politically_involved.label }} {% if form.is_politically_involved.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.is_politically_involved }}
                            {% if form.is_politically_involved.errors %}
                                <div class="error-message">{{ form.is_politically_involved.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="col-md-5 offset-md-1">
                    <!-- Salutation -->
                    <div class="form-group">
                        <label for="{{ form.salutation.id_for_label }}" class="form-label">
                            {{ form.salutation.label }} {% if form.salutation.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.salutation }}
                            {% if form.salutation.errors %}
                                <div class="error-message">{{ form.salutation.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Middle Name -->
                    <div class="form-group">
                        <label for="{{ form.middle_name.id_for_label }}" class="form-label">
                            {{ form.middle_name.label }} {% if form.middle_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.middle_name }}
                            {% if form.middle_name.errors %}
                                <div class="error-message">{{ form.middle_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Date of Birth (Combined BS/AD) -->
                    <div class="form-group">
                        <label class="form-label">
                            Date of Birth {% if form.dob_bs.field.required or form.date_of_birth_ad.field.required %}
                                <span class="text-danger">*</span>
                            {% endif %}
                        </label>
                        <div class="d-flex align-items-center gap-2 w-100">
                            <!-- BS Date -->
                            <div class="flex-grow-1">
                                {{ form.dob_bs }}
                                {% if form.dob_bs.errors %}
                                    <div class="error-message">{{ form.dob_bs.errors }}</div>
                                {% endif %}
                            </div>

                            <!-- AD Date -->
                            <div class="flex-grow-1">
                                {{ form.date_of_birth_ad }}
                                {% if form.date_of_birth_ad.errors %}
                                    <div class="error-message">{{ form.date_of_birth_ad.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Nep Father Name -->
                    <div class="form-group">
                        <label for="{{ form.nep_father_name.id_for_label }}" class="form-label">
                            {{ form.nep_father_name.label }} {% if form.nep_father_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.nep_father_name }}
                            {% if form.nep_father_name.errors %}
                                <div class="error-message">{{ form.nep_father_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Birth Place -->
                    <div class="form-group">
                        <label for="{{ form.birth_place.id_for_label }}" class="form-label">
                            {{ form.birth_place.label }} {% if form.birth_place.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.birth_place }}
                            {% if form.birth_place.errors %}
                                <div class="error-message">{{ form.birth_place.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Document Number -->
                    <div class="form-group">
                        <label for="{{ form.document_number.id_for_label }}" class="form-label">
                            {{ form.document_number.label }} {% if form.document_number.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.document_number }}
                            {% if form.document_number.errors %}
                                <div class="error-message">{{ form.document_number.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Issued Place -->
                    <div class="form-group">
                        <label for="{{ form.issued_place.id_for_label }}" class="form-label">
                            {{ form.issued_place.label }} {% if form.issued_place.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.issued_place }}
                            {% if form.issued_place.errors %}
                                <div class="error-message">{{ form.issued_place.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Document Issued Date (Combined BS/AD) -->
                    <div class="form-group">
                        <label class="form-label">
                            Issued Date {% if form.document_issued_date_bs.field.required or form.document_issued_date.field.required %}
                                <span class="text-danger">*</span>
                            {% endif %}
                        </label>
                        <div class="d-flex align-items-center gap-2 w-100">
                            <!-- BS Date -->
                            <div class="flex-grow-1">
                                {{ form.document_issued_date_bs }}
                                {% if form.document_issued_date_bs.errors %}
                                    <div class="error-message">{{ form.document_issued_date_bs.errors }}</div>
                                {% endif %}
                            </div>

                            <!-- AD Date -->
                            <div class="flex-grow-1">
                                {{ form.document_issued_date }}
                                {% if form.document_issued_date.errors %}
                                    <div class="error-message">{{ form.document_issued_date.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Father/Mother Name -->
                    <div class="form-group">
                        <label for="{{ form.father_mother_name.id_for_label }}" class="form-label">
                            {{ form.father_mother_name.label }} {% if form.father_mother_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.father_mother_name }}
                            {% if form.father_mother_name.errors %}
                                <div class="error-message">{{ form.father_mother_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Ward No -->
                    <div class="form-group">
                        <label for="{{ form.ward_no.id_for_label }}" class="form-label">
                            {{ form.ward_no.label }} {% if form.ward_no.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.ward_no }}
                            {% if form.ward_no.errors %}
                                <div class="error-message">{{ form.ward_no.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Temporary District -->
                    <div class="form-group">
                        <label for="{{ form.temporary_district.id_for_label }}" class="form-label">
                            {{ form.temporary_district.label }} {% if form.temporary_district.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.temporary_district }}
                            {% if form.temporary_district.errors %}
                                <div class="error-message">{{ form.temporary_district.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- House No -->
                    <div class="form-group">
                        <label for="{{ form.house_no.id_for_label }}" class="form-label">
                            {{ form.house_no.label }} {% if form.house_no.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.house_no }}
                            {% if form.house_no.errors %}
                                <div class="error-message">{{ form.house_no.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label for="{{ form.email.id_for_label }}" class="form-label">
                            {{ form.email.label }} {% if form.email.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.email }}
                            {% if form.email.errors %}
                                <div class="error-message">{{ form.email.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Firm Name -->
                    <div class="form-group">
                        <label for="{{ form.firm_name.id_for_label }}" class="form-label">
                            {{ form.firm_name.label }} {% if form.firm_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.firm_name }}
                            {% if form.firm_name.errors %}
                                <div class="error-message">{{ form.firm_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Income Amount -->
                    <div class="form-group">
                        <label for="{{ form.income_amount.id_for_label }}" class="form-label">
                            {{ form.income_amount.label }} {% if form.income_amount.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.income_amount }}
                            {% if form.income_amount.errors %}
                                <div class="error-message">{{ form.income_amount.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Bank Ac No -->
                    <div class="form-group">
                        <label for="{{ form.bank_ac_no.id_for_label }}" class="form-label">
                            {{ form.bank_ac_no.label }} {% if form.bank_ac_no.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.bank_ac_no }}
                            {% if form.bank_ac_no.errors %}
                                <div class="error-message">{{ form.bank_ac_no.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Address Nepali -->
                    <div class="form-group">
                        <label for="{{ form.address_nepali.id_for_label }}" class="form-label">
                            {{ form.address_nepali.label }} {% if form.address_nepali.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.address_nepali }}
                            {% if form.address_nepali.errors %}
                                <div class="error-message">{{ form.address_nepali.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Proposer Full Name -->
                    <div class="form-group">
                        <label for="{{ form.proposer_full_name.id_for_label }}" class="form-label">
                            {{ form.proposer_full_name.label }} {% if form.proposer_full_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.proposer_full_name }}
                            {% if form.proposer_full_name.errors %}
                                <div class="error-message">{{ form.proposer_full_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Nationality -->
                    <div class="form-group">
                        <label for="{{ form.nationality.id_for_label }}" class="form-label">
                            {{ form.nationality.label }} {% if form.nationality.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.nationality }}
                            {% if form.nationality.errors %}
                                <div class="error-message">{{ form.nationality.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- AML Crime -->
                    <div class="form-group">
                        <label for="{{ form.is_aml_crime.id_for_label }}" class="form-label">
                            {{ form.is_aml_crime.label }} {% if form.is_aml_crime.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.is_aml_crime }}
                            {% if form.is_aml_crime.errors %}
                                <div class="error-message">{{ form.is_aml_crime.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <h5 class="section-header mt-4">Family Details</h5>
            <div class="row">
                <!-- Left Column -->
                <div class="col-md-5 offset-md-1">
                    <!-- Spouse Name -->
                    <div class="form-group">
                        <label for="{{ form.spouse_name.id_for_label }}" class="form-label">
                            {{ form.spouse_name.label }} {% if form.spouse_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.spouse_name }}
                            {% if form.spouse_name.errors %}
                                <div class="error-message">{{ form.spouse_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Mother Name -->
                    <div class="form-group">
                        <label for="{{ form.mother_name.id_for_label }}" class="form-label">
                            {{ form.mother_name.label }} {% if form.mother_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.mother_name }}
                            {% if form.mother_name.errors %}
                                <div class="error-message">{{ form.mother_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Son Name -->
                    <div class="form-group">
                        <label for="{{ form.son_name.id_for_label }}" class="form-label">
                            {{ form.son_name.label }} {% if form.son_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.son_name }}
                            {% if form.son_name.errors %}
                                <div class="error-message">{{ form.son_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Daughter/InLaw Name -->
                    <div class="form-group">
                        <label for="{{ form.daughter_in_law_name.id_for_label }}" class="form-label">
                            {{ form.daughter_in_law_name.label }} {% if form.daughter_in_law_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.daughter_in_law_name }}
                            {% if form.daughter_in_law_name.errors %}
                                <div class="error-message">{{ form.daughter_in_law_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- GrandFather/InLaw Name -->
                    <div class="form-group">
                        <label for="{{ form.grandfather_in_law_name.id_for_label }}" class="form-label">
                            {{ form.grandfather_in_law_name.label }} {% if form.grandfather_in_law_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.grandfather_in_law_name }}
                            {% if form.grandfather_in_law_name.errors %}
                                <div class="error-message">{{ form.grandfather_in_law_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Family Politically Involved -->
                    <div class="form-group">
                        <label for="{{ form.is_family_politically_involved.id_for_label }}" class="form-label">
                            {{ form.is_family_politically_involved.label }} {% if form.is_family_politically_involved.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.is_family_politically_involved }}
                            {% if form.is_family_politically_involved.errors %}
                                <div class="error-message">{{ form.is_family_politically_involved.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="col-md-5 offset-md-1">
                    <!-- Grand Father Name -->
                    <div class="form-group">
                        <label for="{{ form.grand_father_name.id_for_label }}" class="form-label">
                            {{ form.grand_father_name.label }} {% if form.grand_father_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.grand_father_name }}
                            {% if form.grand_father_name.errors %}
                                <div class="error-message">{{ form.grand_father_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Daughter Name -->
                    <div class="form-group">
                        <label for="{{ form.daughter_name.id_for_label }}" class="form-label">
                            {{ form.daughter_name.label }} {% if form.daughter_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.daughter_name }}
                            {% if form.daughter_name.errors %}
                                <div class="error-message">{{ form.daughter_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Father/InLaw Name -->
                    <div class="form-group">
                        <label for="{{ form.father_in_law_name.id_for_label }}" class="form-label">
                            {{ form.father_in_law_name.label }} {% if form.father_in_law_name.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.father_in_law_name }}
                            {% if form.father_in_law_name.errors %}
                                <div class="error-message">{{ form.father_in_law_name.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Family AML Crime -->
                    <div class="form-group">
                        <label for="{{ form.is_family_aml_crime.id_for_label }}" class="form-label">
                            {{ form.is_family_aml_crime.label }} {% if form.is_family_aml_crime.field.required %}<span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="field-wrapper">
                            {{ form.is_family_aml_crime }}
                            {% if form.is_family_aml_crime.errors %}
                                <div class="error-message">{{ form.is_family_aml_crime.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>
    
    <script>
        $(document).ready(function(){
            // Helper functions
            function markFieldInvalid(field, message) {
                field.addClass('is-invalid');
                field.next('.error-message').remove();
                field.after('<div class="error-message">' + message + '</div>');
            }
            
            function clearFieldError(field) {
                field.removeClass('is-invalid');
                field.next('.error-message').remove();
            }
            
            function isValidEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }
            
            function isValidMobile(mobile) {
                const re = /^9\d{1,2}-\d{7}$/;
                return re.test(mobile);
            }
            
            function isValidDate(dateString) {
                const re = /^\d{4}-\d{2}-\d{2}$/;
                return re.test(dateString);
            }
            
            function isValidPAN(pan) {
                const re = /^\d{9}$/; // Changed to 9 digits only
                return re.test(pan);
            }

            function isValidWardNo(wardNo) {
                const num = parseInt(wardNo);
                return !isNaN(num) && num >= 1 && num <= 36;
            }

            function isValidIncomeAmount(amount) {
                // Check if it's a whole number (no decimals)
                const re = /^\d+$/;
                return re.test(amount);
            }

            function isValidDocumentNumber(docNumber) {
                // Only numbers allowed
                const re = /^\d+$/;
                return re.test(docNumber);
            }

            function isValidBankAccountNumber(bankNumber) {
                // Only numbers allowed
                const re = /^\d+$/;
                return re.test(bankNumber);
            }

            // Apply input mask for mobile number
            $('#id_mobile').inputmask('999-9999999');

            // Apply input mask for Date of Birth BS field (YYYY-MM-DD format)
            $('#id_dob_bs').inputmask('9999-99-99', {placeholder: "YYYY-MM-DD"});
            
            // Apply input mask for Document Issued Date BS field
            $('#id_document_issued_date_bs').inputmask('9999-99-99', {placeholder: "YYYY-MM-DD"});

            // Apply input mask for phone number
            $('#id_phone_no').inputmask('999-9999999');
            
            // Apply input mask for PAN number (9 digits only)
            $('#id_pan_no').inputmask('999999999', {placeholder: ""});

            // Only allow numbers for document number
            $('#id_document_number').on('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
            });

            // Only allow numbers for house number
            $('#id_house_no').on('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
            });

            // Only allow numbers for bank account number
            $('#id_bank_ac_no').on('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
            });

            // Nepali font validation (Devanagari script)
            const nepaliRegex = /^[\u0900-\u097F\u1CD0-\u1CFF\uA8E0-\uA8FF ]+$/;
            
            // Nepali field validation on blur
            $('#id_nep_name').on('blur', function() {
                if ($(this).val().trim() && !nepaliRegex.test($(this).val())) {
                    markFieldInvalid($(this), 'कृपया नेपालीमा मात्र लेख्नुहोस्');
                } else {
                    clearFieldError($(this));
                }
            });
            
            $('#id_nep_father_name').on('blur', function() {
                if ($(this).val().trim() && !nepaliRegex.test($(this).val())) {
                    markFieldInvalid($(this), 'कृपया नेपालीमा मात्र लेख्नुहोस्');
                } else {
                    clearFieldError($(this));
                }
            });
            
            $('#id_address_nepali').on('blur', function() {
                if ($(this).val().trim() && !nepaliRegex.test($(this).val())) {
                    markFieldInvalid($(this), 'कृपया नेपालीमा मात्र लेख्नुहोस्');
                } else {
                    clearFieldError($(this));
                }
            });

            // Remove default 0 from house number
            $('#id_house_no').val('');

            // Form validation
            $('form').submit(function(e) {
                let isValid = true;
                let firstErrorField = null;
                
                // Clear previous error highlights
                $('.form-control, .form-select').removeClass('is-invalid');
                $('.error-message').remove();
                
                // Required field validation
                $('[required]').each(function() {
                    if (!$(this).val().trim()) {
                        isValid = false;
                        markFieldInvalid($(this), 'This field is required');
                        if (!firstErrorField) firstErrorField = this;
                    }
                });
                
                // Email validation
                const emailField = $('#id_email');
                if (emailField.val().trim() && !isValidEmail(emailField.val())) {
                    isValid = false;
                    markFieldInvalid(emailField, 'Please enter a valid email address');
                    if (!firstErrorField) firstErrorField = emailField[0];
                }
                
                // Mobile number validation
                const mobileField = $('#id_mobile');
                if (mobileField.val().trim() && !isValidMobile(mobileField.val())) {
                    isValid = false;
                    markFieldInvalid(mobileField, 'Please enter a valid mobile number (format: 98-1234567)');
                    if (!firstErrorField) firstErrorField = mobileField[0];
                }
                
                // Date of Birth validation
                const dobBsField = $('#id_dob_bs');
                const dobAdField = $('#id_date_of_birth_ad');
                
                if (dobBsField.val().trim() && !isValidDate(dobBsField.val())) {
                    isValid = false;
                    markFieldInvalid(dobBsField, 'Please enter a valid date (YYYY-MM-DD)');
                    if (!firstErrorField) firstErrorField = dobBsField[0];
                }
                
                if (dobAdField.val().trim() && !isValidDate(dobAdField.val())) {
                    isValid = false;
                    markFieldInvalid(dobAdField, 'Please enter a valid date (YYYY-MM-DD)');
                    if (!firstErrorField) firstErrorField = dobAdField[0];
                }
                
                // Document issued date validation
                const docIssuedBsField = $('#id_document_issued_date_bs');
                const docIssuedAdField = $('#id_document_issued_date');
                
                if (docIssuedBsField.val().trim() && !isValidDate(docIssuedBsField.val())) {
                    isValid = false;
                    markFieldInvalid(docIssuedBsField, 'Please enter a valid date (YYYY-MM-DD)');
                    if (!firstErrorField) firstErrorField = docIssuedBsField[0];
                }
                
                if (docIssuedAdField.val().trim() && !isValidDate(docIssuedAdField.val())) {
                    isValid = false;
                    markFieldInvalid(docIssuedAdField, 'Please enter a valid date (YYYY-MM-DD)');
                    if (!firstErrorField) firstErrorField = docIssuedAdField[0];
                }
                
                // Document number validation (only numbers)
                const docNumberField = $('#id_document_number');
                if (docNumberField.val().trim() && !isValidDocumentNumber(docNumberField.val())) {
                    isValid = false;
                    markFieldInvalid(docNumberField, 'Please enter numbers only for document number');
                    if (!firstErrorField) firstErrorField = docNumberField[0];
                }
                
                // Bank account number validation (only numbers)
                const bankAcNoField = $('#id_bank_ac_no');
                if (bankAcNoField.val().trim() && !isValidBankAccountNumber(bankAcNoField.val())) {
                    isValid = false;
                    markFieldInvalid(bankAcNoField, 'Please enter numbers only for bank account number');
                    if (!firstErrorField) firstErrorField = bankAcNoField[0];
                }
                
                // House number validation (only numbers)
                const houseNoField = $('#id_house_no');
                if (houseNoField.val().trim() && !isValidDocumentNumber(houseNoField.val())) {
                    isValid = false;
                    markFieldInvalid(houseNoField, 'Please enter numbers only for house number');
                    if (!firstErrorField) firstErrorField = houseNoField[0];
                }
                                    
                // PAN number validation (9 digits)
                const panField = $('#id_pan_no');
                if (panField.val().trim() && !isValidPAN(panField.val())) {
                    isValid = false;
                    markFieldInvalid(panField, 'Please enter a valid PAN number (9 digits only)');
                    if (!firstErrorField) firstErrorField = panField[0];
                }
                
                // Ward number validation (1-36)
                const wardField = $('#id_ward_no');
                if (wardField.val().trim() && !isValidWardNo(wardField.val())) {
                    isValid = false;
                    markFieldInvalid(wardField, 'Please enter a valid ward number (1-36)');
                    if (!firstErrorField) firstErrorField = wardField[0];
                }
                
                // Income amount validation (no decimals)
                const incomeField = $('#id_income_amount');
                if (incomeField.val().trim() && !isValidIncomeAmount(incomeField.val())) {
                    isValid = false;
                    markFieldInvalid(incomeField, 'Please enter a whole number (no decimals)');
                    if (!firstErrorField) firstErrorField = incomeField[0];
                }
                
                // Nepali font validation
                const nepNameField = $('#id_nep_name');
                if (nepNameField.val().trim() && !nepaliRegex.test(nepNameField.val())) {
                    isValid = false;
                    markFieldInvalid(nepNameField, 'कृपया नेपाली फन्टमा मात्र लेख्नुहोस्');
                    if (!firstErrorField) firstErrorField = nepNameField[0];
                }
                
                const nepFatherField = $('#id_nep_father_name');
                if (nepFatherField.val().trim() && !nepaliRegex.test(nepFatherField.val())) {
                    isValid = false;
                    markFieldInvalid(nepFatherField, 'कृपया नेपाली फन्टमा मात्र लेख्नुहोस्');
                    if (!firstErrorField) firstErrorField = nepFatherField[0];
                }
                
                const addressNepField = $('#id_address_nepali');
                if (addressNepField.val().trim() && !nepaliRegex.test(addressNepField.val())) {
                    isValid = false;
                    markFieldInvalid(addressNepField, 'कृपया नेपाली फन्टमा मात्र लेख्नुहोस्');
                    if (!firstErrorField) firstErrorField = addressNepField[0];
                }
                
                // If not valid, prevent form submission and scroll to first error
                if (!isValid) {
                    e.preventDefault();
                    if (firstErrorField) {
                        $('html, body').animate({
                            scrollTop: $(firstErrorField).offset().top - 100
                        }, 500);
                        $(firstErrorField).focus();
                    }
                }
            });
        });
    </script>  
</body>
</html>